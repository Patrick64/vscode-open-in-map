<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"/>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <style>
        #mapid { height: 100vh; width: 100%; }
    </style>
</head>
<body>
    <div id="mapid"></div>
    <script>
        var mymap = L.map('mapid').setView([0, 0], 12);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(mymap);

        let markers = [];

        window.addEventListener('message', event => {
            const message = event.data; // The JSON data our extension sent
            switch (message.command) {
                case 'addMarkers':
                    console.log(message.markers);
                    markers = [...markers, ...message.markers];
                    message.markers.forEach(marker => {
                        const newMarker = L.marker(marker).addTo(mymap);    
                        newMarker.bindTooltip(`${marker[0]},${marker[1]}`, {permanent: false});
                    });
                    message.markers.forEach(marker => {
                        const circleMarker = L.circleMarker(marker, {
                            radius: 10,
                            fillColor: "#ff7800",
                            color: "#3287CC",
                            weight: 2,
                            opacity: 1,
                            fillOpacity: 0
                        }).addTo(mymap);

                        // Animate the marker
                        let originalRadius = circleMarker.getRadius();
                        let originalOpacity = circleMarker.options.fillOpacity;
                        let expandInterval = setInterval(() => {
                            let currentRadius = circleMarker.getRadius();
                            let currentOpacity = circleMarker.options.fillOpacity;
                            if (currentRadius < originalRadius + 30) {
                                circleMarker.setRadius(currentRadius + 1);
                                // circleMarker.setStyle({ fillOpacity: currentOpacity - 0.05 });
                            } else {
                                clearInterval(expandInterval);
                                mymap.removeLayer(circleMarker);
                            }
                        }, 50);
                    });

                    // mymap.setView([message.lat, message.lng], 13);
                    mymap.fitBounds(markers, { maxZoom: 12 });
                    break;
            }
        });
    </script>
</body>
</html>